{% load static %}
{% block title %}‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/my_orders.css' %}">

<div class="container">
    <h1>üì¶ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-info">{{ message }}</div>
        {% endfor %}
    {% endif %}

    {% if orders %}
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>  <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
                <th>üÜî ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
                <th>üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                <th>üí≥ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th>
                <th>üìå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‚öôÔ∏è ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order.user.username }}</td>  <!-- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á Username ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ -->
                <td>{{ order.id }}</td>
                <td>{{ order.total_price }} ‡∏ø</td>
                <td>
                    {% if order.payment_method == "cash" %}
                        üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
                    {% elif order.payment_method == "transfer" %}
                        üí≥ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
                        {% if order.slip_image %}
                            <a href="{{ order.slip_image.url }}" target="_blank" class="btn btn-sm btn-info">üìÑ ‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a>
                        {% else %}
                            <span class="text-muted">‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏•‡∏¥‡∏õ</span>
                        {% endif %}
                    {% endif %}
                </td>
                <td>
                    {% if order.status == "preparing" %}
                        <span class="status-badge bg-warning">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                    {% elif order.status == "ready" %}
                        <span class="status-badge bg-info">‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                    {% elif order.status == "completed" %}
                        <span class="status-badge bg-success">üéâ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
                    {% elif order.status == "cancelled" %}
                        <span class="status-badge bg-danger">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                    {% endif %}
                </td>
                <td>{{ order.created_at|date:"d M Y H:i" }}</td>
                <td>
                    {% if request.user.role == "admin" %}
                        <form method="POST" action="{% url 'update_order_status' order.id %}">
                            {% csrf_token %}
                            <select name="status" class="form-select form-select-sm d-inline w-auto">
                                <option value="preparing" {% if order.status == "preparing" %}selected{% endif %}>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                                <option value="ready" {% if order.status == "ready" %}selected{% endif %}>‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                                <option value="completed" {% if order.status == "completed" %}selected{% endif %}>üéâ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>
                                <option value="cancelled" {% if order.status == "cancelled" %}selected{% endif %}>‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                            </select>
                            <button type="submit" class="btn btn-sm btn-update">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</button>
                        </form>
                    {% else %}
                        <span class="text-muted">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div class="alert alert-warning no-orders">‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
    {% endif %}
</div>  
{% endblock %}
